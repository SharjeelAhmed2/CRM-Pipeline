{"version":3,"file":"content.js","mappings":";;;;;;;;;;AAAa;AACb;AACA,4BAA4B,+DAA+D,iBAAiB;AAC5G;AACA,oCAAoC,MAAM,+BAA+B,YAAY;AACrF,mCAAmC,MAAM,mCAAmC,YAAY;AACxF,gCAAgC;AAChC;AACA,KAAK;AACL;AACA;AACA,cAAc,6BAA6B,0BAA0B,cAAc,qBAAqB;AACxG,6IAA6I,cAAc;AAC3J,uBAAuB,sBAAsB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC;AACxC,mCAAmC,SAAS;AAC5C,mCAAmC,WAAW,UAAU;AACxD,0CAA0C,cAAc;AACxD;AACA,8GAA8G,OAAO;AACrH,iFAAiF,iBAAiB;AAClG,yDAAyD,gBAAgB,QAAQ;AACjF,+CAA+C,gBAAgB,gBAAgB;AAC/E;AACA,kCAAkC;AAClC;AACA;AACA,UAAU,YAAY,aAAa,SAAS,UAAU;AACtD,oCAAoC,SAAS;AAC7C;AACA;AACA;AACA,6EAA6E,OAAO;AACpF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,yCAAyC;AAC/C,MAAM,4CAA4C;AAClD,MAAM,yDAAyD;AAC/D,MAAM,+CAA+C;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8EAA8E;AAC9E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4DAA4D,4BAA4B,6BAA6B,gDAAgD;AACrK;AACA;AACA,uDAAuD,wBAAwB,yCAAyC,8BAA8B,6BAA6B,4BAA4B,0BAA0B;AACzO;AACA;AACA,iEAAiE,qBAAqB,WAAW,QAAQ,2EAA2E,6CAA6C,kCAAkC,8BAA8B,6HAA6H,oCAAoC,qCAAqC,+BAA+B,kCAAkC,gCAAgC,sCAAsC,2BAA2B,kCAAkC,wLAAwL,uCAAuC,yCAAyC,sCAAsC,iJAAiJ,2BAA2B,0BAA0B,8BAA8B,8BAA8B,6BAA6B,+BAA+B;AACvxC;AACA;AACA;AACA,4DAA4D,0BAA0B,wBAAwB,iCAAiC,mBAAmB,yBAAyB;AAC3L;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wEAAwE,2BAA2B;AACnG,0CAA0C,+BAA+B;AACzE;AACA,iBAAiB;AACjB,aAAa;AACb;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,qDAAqD,mBAAmB,oBAAoB,2CAA2C,4BAA4B,wBAAwB,6BAA6B,iDAAiD,yBAAyB,uBAAuB;AACzT;AACA,uDAAuD,iBAAiB,kBAAkB,mBAAmB,oBAAoB,sCAAsC,yBAAyB;AAChM;AACA,iEAAiE,kBAAkB,gEAAgE,wHAAwH,+BAA+B,4CAA4C,qCAAqC,sCAAsC,+HAA+H,+BAA+B,4CAA4C,qCAAqC,uEAAuE,UAAU,2EAA2E,+BAA+B,sCAAsC,+BAA+B,+BAA+B,qCAAqC,kCAAkC,sHAAsH,+BAA+B,sCAAsC,+BAA+B,+BAA+B,qCAAqC,kCAAkC;AACtzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAsC,+BAA+B;AACrE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD,4BAA4B,qCAAqC,sCAAsC,kCAAkC,iCAAiC,+BAA+B,iCAAiC;AACjS;AACA;AACA;AACA;AACA,6DAA6D,gCAAgC,iCAAiC;AAC9H;AACA;AACA;AACA,4DAA4D,+BAA+B,kCAAkC,+BAA+B,sCAAsC,8BAA8B;AAChO;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uEAAuE,mBAAmB,iBAAiB,uBAAuB,uBAAuB,8BAA8B,iDAAiD,wBAAwB,wBAAwB,iCAAiC,2BAA2B;AACpV;AACA,+DAA+D;AAC/D,8EAA8E,sBAAsB,uBAAuB,yNAAyN,uBAAuB,0BAA0B;AACrY;AACA;AACA;AACA,uEAAuE,4BAA4B,qCAAqC,sCAAsC,kCAAkC,iCAAiC,+BAA+B,iCAAiC;AACjT;AACA;AACA;AACA,4EAA4E;AAC5E,yEAAyE,4BAA4B,6BAA6B;AAClI;AACA;AACA;AACA,4EAA4E,+BAA+B,kCAAkC,+BAA+B,sCAAsC,8BAA8B;AAChP;AACA;AACA;AACA,qBAAqB;AACrB;AACA,sEAAsE,2BAA2B,wBAAwB;AACzH;AACA;AACA,6EAA6E,iCAAiC,oBAAoB;AAClI;AACA;AACA,2EAA2E,wCAAwC,4BAA4B;AAC/I;AACA;AACA,qEAAqE,uBAAuB,8BAA8B,uBAAuB,uBAAuB,6BAA6B,0BAA0B,4CAA4C;AAC3Q;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gFAAgF,8BAA8B,8BAA8B,4BAA4B,kCAAkC,+CAA+C,+BAA+B;AACxR;AACA;AACA;AACA;AACA,sFAAsF,gEAAgE,mEAAmE,kBAAkB,mBAAmB;AAC9P,gFAAgF,iBAAiB,cAAc,kBAAkB,iBAAiB,YAAY,iBAAiB;AAC/K,uFAAuF,iBAAiB;AACxG,gFAAgF,iBAAiB,cAAc,kBAAkB,iBAAiB,YAAY,iBAAiB;AAC/K,+FAA+F,mBAAmB,eAAe;AACjI;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB,qBAAqB;AACrB;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oQAAoQ,2BAA2B,2BAA2B,+BAA+B,iCAAiC,8BAA8B,8BAA8B,gCAAgC,iCAAiC,4BAA4B,oCAAoC,yBAAyB;AAChlB;AACA;AACA,6DAA6D,0BAA0B,qCAAqC,2BAA2B;AACvJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D,2EAA2E,qEAAqE,6CAA6C,6BAA6B,iDAAiD,uBAAuB,yBAAyB;AACrX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,wEAAwE,kCAAkC,iEAAiE,gCAAgC;AAC3M;AACA,2DAA2D;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,aAAa,IAAI;AACjB;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC;AACzC;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mEAAmE,+BAA+B;AAClG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,iBAAiB;AACjB;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,gHAAgH,kDAAkD,WAAW,kFAAkF,6BAA6B,WAAW,8EAA8E,yBAAyB,uCAAuC,WAAW,gDAAgD,yBAAyB,WAAW;AACphB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;UEh1BA;UACA;UACA;UACA;UACA","sources":["webpack://gmail-crm-extension/./src/content.tsx","webpack://gmail-crm-extension/webpack/before-startup","webpack://gmail-crm-extension/webpack/startup","webpack://gmail-crm-extension/webpack/after-startup"],"sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n    return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\n// src/content.tsx\nconsole.log('Content script starting...');\nvar GMAIL_URL_PATTERN = 'https://mail.google.com';\n// Default stages\nvar defaultStages = [\n    { id: '1', name: 'Lead', color: '#4A5568' }, // Dark gray\n    { id: '2', name: 'Pitched', color: '#4299E1' }, // Blue\n    { id: '3', name: 'Waiting for Proposal', color: '#9F7AEA' }, // Purple\n    { id: '4', name: 'Warm Lead', color: '#F56565' } // Red\n];\n// To maintain multiple reloads \nvar observerState = {\n    isInitialized: false,\n    sidebarCreated: false\n};\n// Storage utility functions\n// Create the StorageUtils object with all storage-related functions\nvar StorageUtils = {\n    // Save email to stage function\n    saveEmailToStage: function (emailData, stageId) {\n        return __awaiter(this, void 0, void 0, function () {\n            var key, result, emails, error_1;\n            var _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _b.trys.push([0, 3, , 4]);\n                        key = \"stage_\".concat(stageId);\n                        return [4 /*yield*/, chrome.storage.local.get([key])];\n                    case 1:\n                        result = _b.sent();\n                        emails = result[key] || [];\n                        emails.push(emailData);\n                        if (emails.length > 50) {\n                            emails = emails.slice(-50);\n                        }\n                        return [4 /*yield*/, chrome.storage.local.set((_a = {}, _a[key] = emails, _a))];\n                    case 2:\n                        _b.sent();\n                        return [2 /*return*/, true];\n                    case 3:\n                        error_1 = _b.sent();\n                        console.error('Error saving email:', error_1);\n                        return [2 /*return*/, false];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        });\n    },\n    // Load emails for a stage function\n    loadStageEmails: function (stageId) {\n        return __awaiter(this, void 0, void 0, function () {\n            var key, result, error_2;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 2, , 3]);\n                        key = \"stage_\".concat(stageId);\n                        return [4 /*yield*/, chrome.storage.local.get([key])];\n                    case 1:\n                        result = _a.sent();\n                        return [2 /*return*/, result[key] || []];\n                    case 2:\n                        error_2 = _a.sent();\n                        console.error('Error loading emails:', error_2);\n                        return [2 /*return*/, []];\n                    case 3: return [2 /*return*/];\n                }\n            });\n        });\n    }\n};\n// Compress email data before storage\nfunction compressEmailData(email) {\n    return {\n        i: email.id,\n        s: email.subject.substring(0, 100), // Limit subject length\n        f: email.sender.substring(0, 50), // Limit sender length\n        t: email.timestamp\n    };\n}\n// Decompress email data for display\nfunction decompressEmailData(stored) {\n    return {\n        id: stored.i,\n        subject: stored.s,\n        sender: stored.f,\n        timestamp: stored.t\n    };\n}\n// Update the createStageElement function to match your UI\nfunction createStageElement(stage) {\n    var stageDiv = document.createElement('div');\n    stageDiv.className = 'pipeline-stage';\n    stageDiv.setAttribute('data-stage-id', stage.id);\n    stageDiv.style.cssText = \"\\n        margin-bottom: 10px;\\n        background: white;\\n        border-radius: 4px;\\n        box-shadow: 0 1px 3px rgba(0,0,0,0.1);\\n    \";\n    // Create the header with arrow indicator\n    var headerDiv = document.createElement('div');\n    headerDiv.style.cssText = \"\\n        padding: 10px;\\n        display: flex;\\n        justify-content: space-between;\\n        align-items: center;\\n        border-radius: 4px;\\n        background: white;\\n        cursor: pointer;\\n    \";\n    // Modified header structure to include arrow\n    // Modified header content structure with new styling for stage name\n    headerDiv.innerHTML = \"\\n        <div style=\\\"display: flex; align-items: center; gap: 12px; flex: 1;\\\">\\n            <span style=\\\"\\n                transform: rotate(-90deg);\\n                transition: transform 0.2s;\\n                font-size: 12px;\\n                color: #666;\\n            \\\">\\u25BC</span>\\n            \\n            <div style=\\\"\\n                background: \".concat(stage.color, \";\\n                padding: 4px 12px;\\n                border-radius: 4px;\\n                color: white;\\n                font-size: 13px;\\n                display: flex;\\n                align-items: center;\\n                gap: 8px;\\n                min-width: 80px;\\n            \\\">\\n                <span>\").concat(stage.name, \"</span>\\n                <span class=\\\"stage-count\\\" style=\\\"\\n                    background: rgba(255, 255, 255, 0.2);\\n                    padding: 2px 6px;\\n                    border-radius: 3px;\\n                    font-size: 12px;\\n                \\\">0</span>\\n            </div>\\n        </div>\\n        <button class=\\\"delete-stage\\\" style=\\\"\\n            background: none;\\n            border: none;\\n            color: #666;\\n            cursor: pointer;\\n            font-size: 18px;\\n            padding: 0 4px;\\n            margin-left: 8px;\\n        \\\">\\u00D7</button>\\n    \");\n    // Create a container for emails that will appear below the header\n    var emailsContainer = document.createElement('div');\n    emailsContainer.className = 'stage-emails-container';\n    emailsContainer.style.cssText = \"\\n        padding: 8px;\\n        margin-top: 4px;\\n        display: flex;\\n        flex-direction: column;\\n        gap: 8px;\\n        display: none; /* Initially hidden */\\n    \";\n    stageDiv.appendChild(headerDiv);\n    stageDiv.appendChild(emailsContainer);\n    // Add collapse/expand functionality\n    var arrow = headerDiv.querySelector('span');\n    headerDiv.addEventListener('click', function (e) {\n        // Ignore clicks on delete button\n        if (!e.target.closest('.delete-stage')) {\n            var isExpanded = emailsContainer.style.display !== 'none';\n            emailsContainer.style.display = isExpanded ? 'none' : 'flex';\n            if (arrow) {\n                arrow.style.transform = isExpanded ? 'rotate(-90deg)' : 'rotate(0deg)';\n            }\n        }\n    });\n    // Add existing delete functionality\n    var deleteBtn = headerDiv.querySelector('.delete-stage');\n    deleteBtn === null || deleteBtn === void 0 ? void 0 : deleteBtn.addEventListener('click', function (e) {\n        e.stopPropagation();\n        if (confirm(\"Are you sure you want to delete \\\"\".concat(stage.name, \"\\\" stage?\"))) {\n            chrome.storage.sync.get(['pipelineStages'], function (result) {\n                var currentStages = result.pipelineStages || defaultStages;\n                var updatedStages = currentStages.filter(function (s) { return s.id !== stage.id; });\n                chrome.storage.sync.set({ pipelineStages: updatedStages }, function () {\n                    stageDiv.remove();\n                });\n            });\n        }\n    });\n    return stageDiv;\n}\n/// For Add Stage Button Functionality \nfunction createAddStageForm() {\n    var modal = document.createElement('div');\n    modal.style.cssText = \"\\n        position: fixed;\\n        top: 50%;\\n        left: 50%;\\n        transform: translate(-50%, -50%);\\n        background: white;\\n        padding: 20px;\\n        border-radius: 8px;\\n        box-shadow: 0 2px 10px rgba(0,0,0,0.1);\\n        z-index: 10001;\\n        width: 300px;\\n    \";\n    var overlay = document.createElement('div');\n    overlay.style.cssText = \"\\n        position: fixed;\\n        top: 0;\\n        left: 0;\\n        right: 0;\\n        bottom: 0;\\n        background: rgba(0,0,0,0.5);\\n        z-index: 10000;\\n    \";\n    var form = document.createElement('form');\n    form.innerHTML = \"\\n        <h3 style=\\\"margin-bottom: 15px; font-weight: bold;\\\">Add New Stage</h3>\\n        <div style=\\\"margin-bottom: 15px;\\\">\\n            <input type=\\\"text\\\" id=\\\"stageName\\\" placeholder=\\\"Stage Name\\\" style=\\\"\\n                width: 100%;\\n                padding: 8px;\\n                border: 1px solid #e2e8f0;\\n                border-radius: 4px;\\n                margin-bottom: 10px;\\n            \\\">\\n            <input type=\\\"color\\\" id=\\\"stageColor\\\" value=\\\"#718096\\\" style=\\\"\\n                width: 100%;\\n                height: 40px;\\n                border: 1px solid #e2e8f0;\\n                border-radius: 4px;\\n            \\\">\\n        </div>\\n        <div style=\\\"display: flex; gap: 10px;\\\">\\n            <button type=\\\"submit\\\" style=\\\"\\n                flex: 1;\\n                padding: 8px;\\n                background: #4299E1;\\n                color: white;\\n                border: none;\\n                border-radius: 4px;\\n                cursor: pointer;\\n            \\\">Add</button>\\n            <button type=\\\"button\\\" id=\\\"cancelBtn\\\" style=\\\"\\n                flex: 1;\\n                padding: 8px;\\n                background: #CBD5E0;\\n                color: white;\\n                border: none;\\n                border-radius: 4px;\\n                cursor: pointer;\\n            \\\">Cancel</button>\\n        </div>\\n    \";\n    modal.appendChild(form);\n    // Handle form submission\n    form.addEventListener('submit', function (e) {\n        e.preventDefault();\n        var nameInput = document.getElementById('stageName');\n        var colorInput = document.getElementById('stageColor');\n        var newStage = {\n            id: Date.now().toString(),\n            name: nameInput.value,\n            color: colorInput.value\n        };\n        // Get current stages and add new one\n        chrome.storage.sync.get(['pipelineStages'], function (result) {\n            var currentStages = result.pipelineStages || defaultStages;\n            var updatedStages = __spreadArray(__spreadArray([], currentStages, true), [newStage], false);\n            // Save updated stages\n            chrome.storage.sync.set({ pipelineStages: updatedStages }, function () {\n                // Update header with new stages\n                updatePipelineHeader(updatedStages);\n                // Add new stage to UI\n                var stagesContainer = document.getElementById('pipeline-stages');\n                if (stagesContainer) {\n                    stagesContainer.appendChild(createStageElement(newStage));\n                }\n                // Remove modal\n                document.body.removeChild(modal);\n                document.body.removeChild(overlay);\n            });\n        });\n    });\n    // Handle cancel\n    var cancelBtn = form.querySelector('#cancelBtn');\n    cancelBtn === null || cancelBtn === void 0 ? void 0 : cancelBtn.addEventListener('click', function () {\n        document.body.removeChild(modal);\n        document.body.removeChild(overlay);\n    });\n    // Add modal and overlay to page\n    document.body.appendChild(overlay);\n    document.body.appendChild(modal);\n}\n// Function to update header with stages\nfunction updatePipelineHeader(stages) {\n    var pipelineOverview = document.getElementById('pipeline-overview');\n    if (!pipelineOverview)\n        return;\n    pipelineOverview.innerHTML = '';\n    stages.forEach(function (stage) {\n        var segment = document.createElement('div');\n        segment.style.cssText = \"\\n            flex: 1;\\n            display: flex;\\n            flex-direction: column;\\n            justify-content: center;\\n            align-items: center;\\n            text-align: center;\\n            padding: 8px 4px;\\n            position: relative;\\n        \";\n        // Add count\n        var count = document.createElement('div');\n        count.textContent = '0';\n        count.className = \"header-count-\".concat(stage.id);\n        count.style.cssText = \"\\n            font-size: 18px;\\n            font-weight: bold;\\n            margin-bottom: 4px;\\n        \";\n        // Add stage name\n        var name = document.createElement('div');\n        name.textContent = stage.name;\n        name.style.cssText = \"\\n            font-size: 11px;\\n            line-height: 1.2;\\n            white-space: nowrap;\\n            overflow: hidden;\\n            text-overflow: ellipsis;\\n            max-width: 100%;\\n        \";\n        segment.appendChild(count);\n        segment.appendChild(name);\n        pipelineOverview.appendChild(segment);\n    });\n}\n// For Sidebar\nfunction createSidebar() {\n    return __awaiter(this, void 0, void 0, function () {\n        var sidebar, pipelineOverview, stages, contentSection, stagesContainer, footerSection, addButton, gmailContent;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    sidebar = document.createElement('div');\n                    sidebar.id = 'gmail-crm-sidebar';\n                    sidebar.style.cssText = \"\\n        position: fixed;\\n        right: 0;\\n        top: 0;\\n        width: 450px;\\n        height: 100%;\\n        background: #f8fafc;\\n        box-shadow: -2px 0 5px rgba(0,0,0,0.1);\\n        z-index: 1000;\\n        display: flex;\\n        flex-direction: column;\\n        overflow: hidden;\\n    \";\n                    pipelineOverview = document.createElement('div');\n                    pipelineOverview.id = 'pipeline-overview'; // Add this line\n                    pipelineOverview.style.cssText = \"\\n        display: flex;\\n        width: 100%;\\n        height: 60px;\\n        background: linear-gradient(90deg, \\n            #4B5563 0%, \\n            #60A5FA 20%, \\n            #C084FC 40%, \\n            #EF4444 60%, \\n            #34D399 80%, \\n            #FCD34D 100%\\n        );\\n        color: white;\\n        font-size: 13px;\\n    \";\n                    stages = [defaultStages];\n                    stages[0].forEach(function (stage) {\n                        var segment = document.createElement('div');\n                        segment.style.cssText = \"\\n            flex: 1;\\n            display: flex;\\n            flex-direction: column;\\n            justify-content: center;\\n            align-items: center;\\n            text-align: center;\\n            padding: 8px 4px;\\n            position: relative;\\n        \";\n                        // Add count\n                        var count = document.createElement('div');\n                        count.textContent = '0';\n                        count.className = \"header-count-\".concat(stage.id); // Add this line\n                        count.style.cssText = \"\\n        font-size: 18px;\\n        font-weight: bold;\\n        margin-bottom: 4px;\\n    \";\n                        // Add stage name\n                        var name = document.createElement('div');\n                        name.textContent = stage.name;\n                        name.style.cssText = \"\\n            font-size: 11px;\\n            line-height: 1.2;\\n            white-space: nowrap;\\n            overflow: hidden;\\n            text-overflow: ellipsis;\\n            max-width: 100%;\\n        \";\n                        segment.appendChild(count);\n                        segment.appendChild(name);\n                        pipelineOverview.appendChild(segment);\n                    });\n                    contentSection = document.createElement('div');\n                    contentSection.style.cssText = \"\\n        flex: 1;\\n        overflow-y: auto;\\n        padding: 16px;\\n    \";\n                    stagesContainer = document.createElement('div');\n                    stagesContainer.id = 'pipeline-stages';\n                    stagesContainer.style.cssText = \"\\n        display: flex;\\n        flex-direction: column;\\n        gap: 16px;\\n    \";\n                    contentSection.appendChild(stagesContainer);\n                    footerSection = document.createElement('div');\n                    footerSection.style.cssText = \"\\n        padding: 16px;\\n        border-top: 1px solid #e5e7eb;\\n        background: white;\\n    \";\n                    addButton = document.createElement('button');\n                    addButton.textContent = '+ Add Stage';\n                    addButton.style.cssText = \"\\n        width: 100%;\\n        padding: 8px;\\n        background: #4299E1;\\n        color: white;\\n        border: none;\\n        border-radius: 4px;\\n        cursor: pointer;\\n        transition: background-color 0.2s;\\n    \";\n                    addButton.addEventListener('click', createAddStageForm);\n                    footerSection.appendChild(addButton);\n                    // Assemble sidebar\n                    sidebar.appendChild(pipelineOverview);\n                    sidebar.appendChild(contentSection);\n                    sidebar.appendChild(footerSection);\n                    // Add to page\n                    document.body.appendChild(sidebar);\n                    gmailContent = document.querySelector('.bkK');\n                    if (gmailContent) {\n                        gmailContent.style.marginRight = '450px';\n                    }\n                    // Load stages\n                    chrome.storage.sync.get(['pipelineStages'], function (result) {\n                        var stages = result.pipelineStages || defaultStages;\n                        updatePipelineHeader(stages);\n                        stages.forEach(function (stage) {\n                            stagesContainer.appendChild(createStageElement(stage));\n                        });\n                    });\n                    return [4 /*yield*/, loadSavedEmails()];\n                case 1:\n                    _a.sent();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\n// Add this new function to handle adding emails to stages\n// Update addEmailToStage function to match your UI\nfunction addEmailToStage(emailData, stage, stageDiv) {\n    return __awaiter(this, void 0, void 0, function () {\n        var saved, emailsContainer, existingEmailInUI, truncateText, emailDiv_1, sender_1, subjectText_1, timestamp, countElement, currentCount, headerCount, error_3;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    _a.trys.push([0, 2, , 3]);\n                    return [4 /*yield*/, StorageUtils.saveEmailToStage(emailData, stage.id)];\n                case 1:\n                    saved = _a.sent();\n                    if (!saved) {\n                        console.error('Failed to save email');\n                        return [2 /*return*/];\n                    }\n                    emailsContainer = stageDiv.querySelector('.stage-emails-container');\n                    if (!emailsContainer) {\n                        console.error('Emails container not found');\n                        return [2 /*return*/];\n                    }\n                    existingEmailInUI = emailsContainer.querySelector(\"[data-email-id=\\\"\".concat(emailData.id, \"\\\"]\"));\n                    console.log(\"Existing Email Data: \", existingEmailInUI);\n                    if (existingEmailInUI) {\n                        console.log('Email already displayed in UI, skipping render');\n                        return [2 /*return*/];\n                    }\n                    truncateText = function (text, limit) {\n                        if (text.length <= limit)\n                            return text;\n                        return {\n                            short: text.substring(0, limit) + '...',\n                            full: text\n                        };\n                    };\n                    emailDiv_1 = document.createElement('div');\n                    emailDiv_1.className = 'pipeline-email';\n                    emailDiv_1.setAttribute('data-email-id', emailData.id);\n                    emailDiv_1.style.cssText = \"\\n            padding: 8px 16px;\\n            cursor: pointer;\\n            font-size: 13px;\\n            display: flex;\\n            align-items: center;\\n            border-bottom: 1px solid #E5E7EB;\\n            min-height: 40px;\\n        \";\n                    sender_1 = truncateText(emailData.sender, 5);\n                    subjectText_1 = truncateText(emailData.subject, 30);\n                    timestamp = new Date(emailData.timestamp).toLocaleDateString();\n                    // Create the row content\n                    emailDiv_1.innerHTML = \"\\n            <div style=\\\"flex: 0 0 30px;\\\">\\n                <input type=\\\"checkbox\\\" style=\\\"margin: 0;\\\">\\n            </div>\\n            <div style=\\\"flex: 1 1 100px; overflow: hidden; padding-right: 5px;\\\" class=\\\"sender-cell\\\">\\n                \".concat(typeof sender_1 === 'string' ? sender_1 : sender_1.short, \"\\n                \").concat(typeof sender_1 === 'object' ?\n                        \"<button class=\\\"see-more-btn\\\" style=\\\"color: #4299E1; font-size: 11px; border: none; background: none; cursor: pointer; padding: 0; margin-left: 4px;\\\">see more</button>\"\n                        : '', \"\\n            </div>\\n            <div style=\\\"flex: 1; overflow: hidden;\\\" class=\\\"subject-cell\\\">\\n                \").concat(typeof subjectText_1 === 'string' ? subjectText_1 : subjectText_1.short, \"\\n                \").concat(typeof subjectText_1 === 'object' ?\n                        \"<button class=\\\"see-more-btn\\\" style=\\\"color: #4299E1; font-size: 11px; border: none; background: none; cursor: pointer; padding: 0; margin-left: 4px;\\\">see more</button>\"\n                        : '', \"\\n            </div>\\n            <div style=\\\"flex: 0 0 100px; text-align: right; color: #6B7280;\\\">\\n                \").concat(timestamp, \"\\n            </div>\\n        \");\n                    // Add \"See More\" functionality\n                    emailDiv_1.querySelectorAll('.see-more-btn').forEach(function (btn) {\n                        btn.addEventListener('click', function (e) {\n                            e.stopPropagation();\n                            var cell = btn.parentElement;\n                            if (cell) {\n                                if (cell.classList.contains('sender-cell')) {\n                                    cell.textContent = typeof sender_1 === 'object' ? sender_1.full : sender_1;\n                                }\n                                else if (cell.classList.contains('subject-cell')) {\n                                    cell.textContent = typeof subjectText_1 === 'object' ? subjectText_1.full : subjectText_1;\n                                }\n                            }\n                        });\n                    });\n                    // Add hover effect\n                    emailDiv_1.addEventListener('mouseenter', function () {\n                        emailDiv_1.style.backgroundColor = '#F3F4F6';\n                    });\n                    emailDiv_1.addEventListener('mouseleave', function () {\n                        emailDiv_1.style.backgroundColor = 'transparent';\n                    });\n                    // Add to container\n                    emailsContainer.appendChild(emailDiv_1);\n                    countElement = stageDiv.querySelector('.stage-count');\n                    if (countElement) {\n                        currentCount = parseInt(countElement.textContent || '0');\n                        countElement.textContent = (currentCount + 1).toString();\n                        console.log(\"Added Counts for Stages\", countElement);\n                        headerCount = document.querySelector(\".header-count-\".concat(stage.id));\n                        if (headerCount) {\n                            headerCount.textContent = (currentCount + 1).toString();\n                            console.log(\"Updated header count for stage\", stage.id, \"to\", currentCount + 1);\n                        }\n                    }\n                    return [3 /*break*/, 3];\n                case 2:\n                    error_3 = _a.sent();\n                    console.error('Error in addEmailToStage:', error_3);\n                    return [3 /*break*/, 3];\n                case 3: return [2 /*return*/];\n            }\n        });\n    });\n}\n// 5:11 AM on Friday the 10th \n// Add this function to save email data to storage\n// Update saveEmailToStage to include better error handling\n/// Email Dragable Function\n/*\nThe move button is now always created and positioned next to the checkbox\nThe button becomes visible on row hover instead of row selection\nAdded a simple icon (ðŸ“‹) to make it more compact\nAdded proper z-index to ensure the button stays above other elements\nAdded transition effects for smooth appearance/disappearance\nAdded checks to prevent duplicate buttons\nImproved the initialization tracking\n*/\n/**Simplified the selectors to better match Gmail's structure\nRemoved the opacity transition and hover effects (making buttons always visible)\nIncreased z-index to ensure buttons appear above Gmail's interface\nAdded more specific targeting for email elements\nAdded more debug logging\nFixed the observer logic\nAdded a delay after page load to ensure Gmail is fully initialized */\nfunction makeEmailDraggable(emailRow) {\n    // Verify this is actually an email row\n    if (!emailRow.classList.contains('zA')) {\n        console.log('Not an email row, skipping:', emailRow);\n        return;\n    }\n    // First, check if the button is already added\n    if (emailRow.querySelector('.crm-move-button')) {\n        return;\n    }\n    var moveButton = document.createElement('button');\n    moveButton.className = 'crm-move-button';\n    moveButton.innerHTML = 'ðŸ“‹';\n    moveButton.title = 'Move to Pipeline';\n    moveButton.style.cssText = \"\\n                   background: linear-gradient(90deg, \\n            #4B5563 0%, \\n            #60A5FA 20%, \\n            #C084FC 40%, \\n            #EF4444 60%, \\n            #34D399 80%, \\n            #FCD34D 100%\\n        );\\n            color: white;\\n            border: none;\\n            padding: 4px 8px;\\n            border-radius: 4px;\\n            font-size: 12px;\\n            cursor: pointer;\\n            margin-right: 8px;\\n            position: relative;\\n            z-index: 9999;\\n            display: inline-block;\\n            opacity: 1;\\n        \";\n    // Create a new table cell for our button\n    var buttonCell = document.createElement('td');\n    buttonCell.style.cssText = \"\\n            padding: 0 8px;\\n            width: 40px;\\n            vertical-align: middle;\\n            border: none;\\n        \";\n    buttonCell.appendChild(moveButton);\n    // Insert the new cell after the checkbox cell\n    var firstCell = emailRow.querySelector('td');\n    if (firstCell) {\n        firstCell.after(buttonCell);\n        console.log(\"Button inserted in Make Email Dragable\");\n    }\n    moveButton.addEventListener('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        console.log('Move button clicked');\n        var getEmailData = function () {\n            var _a, _b, _c, _d, _e, _f;\n            // Get all table cells in the row\n            var cells = emailRow.querySelectorAll('td');\n            // Find subject from the third cell typically\n            var subjectCell = Array.from(cells).find(function (cell) {\n                return cell.querySelector('[role=\"link\"]') ||\n                    cell.querySelector('.bog') ||\n                    cell.querySelector('.bqe');\n            });\n            var subject = (_a = subjectCell === null || subjectCell === void 0 ? void 0 : subjectCell.textContent) === null || _a === void 0 ? void 0 : _a.trim();\n            // Find sender from the relevant cell\n            // First try to find the email directly\n            var sender = (_b = emailRow.querySelector('[email]')) === null || _b === void 0 ? void 0 : _b.getAttribute('email');\n            if (!sender) {\n                // If no email attribute, try to get the sender name/email from text content\n                var senderCell = Array.from(cells).find(function (cell) {\n                    return cell.querySelector('.yP') || cell.querySelector('.bA4');\n                });\n                sender = (_c = senderCell === null || senderCell === void 0 ? void 0 : senderCell.textContent) === null || _c === void 0 ? void 0 : _c.trim();\n            }\n            // Find timestamp from the last cell\n            var lastCell = cells[cells.length - 1];\n            var timeElement = (lastCell === null || lastCell === void 0 ? void 0 : lastCell.querySelector('span[title]')) || lastCell;\n            var timestamp = (timeElement === null || timeElement === void 0 ? void 0 : timeElement.getAttribute('title')) ||\n                ((_d = timeElement === null || timeElement === void 0 ? void 0 : timeElement.textContent) === null || _d === void 0 ? void 0 : _d.trim());\n            console.log('Raw extracted values:', {\n                cells: cells.length,\n                subject: subject,\n                sender: sender,\n                timestamp: timestamp,\n                rowHTML: emailRow.innerHTML\n            });\n            // Clean up and validate the data\n            if (!subject || subject === '') {\n                console.log('Missing subject');\n                return null;\n            }\n            // Ensure we have some form of sender identification\n            if (!sender || sender === '') {\n                // Try to get any sender information from the row\n                var anyNameOrEmail = (_f = (_e = emailRow.textContent) === null || _e === void 0 ? void 0 : _e.match(/[\\w.-]+@[\\w.-]+\\.\\w+/)) === null || _f === void 0 ? void 0 : _f[0];\n                sender = anyNameOrEmail || 'Unknown Sender';\n            }\n            // Ensure we have some form of timestamp\n            if (!timestamp || timestamp === '') {\n                // Use current date as fallback\n                var now = new Date();\n                timestamp = now.toLocaleString();\n            }\n            var emailData = {\n                // Create a consistent ID by hashing the subject and sender\n                id: \"\".concat(subject, \"-\").concat(sender).replace(/[^a-zA-Z0-9]/g, ''),\n                subject: subject,\n                sender: sender,\n                timestamp: timestamp\n            };\n            console.log('Final processed email data:', emailData);\n            return emailData;\n        };\n        var emailData = getEmailData();\n        if (emailData) {\n            console.log('Email data extracted:', emailData);\n            showStageSelectionPopup(emailData, e.clientX, e.clientY);\n        }\n        else {\n            console.error('Failed to extract email data');\n        }\n    });\n}\n// Update the showStageSelectionPopup function to properly pass the data\n// Add debug logging to track the flow\nfunction showStageSelectionPopup(emailData, x, y) {\n    var _this = this;\n    console.log('Opening stage selection popup with data:', emailData);\n    // Remove any existing popups first\n    var existingPopup = document.querySelector('.stage-selection-popup');\n    if (existingPopup) {\n        existingPopup.remove();\n    }\n    // Find the button that was clicked (the parent element with crm-move-button class)\n    var button = document.querySelector('.crm-move-button:hover');\n    if (!button) {\n        console.log('Button not found');\n        return;\n    }\n    // Get the button's position relative to the document\n    var buttonRect = button.getBoundingClientRect();\n    var popup = document.createElement('div');\n    popup.className = 'stage-selection-popup';\n    popup.style.cssText = \"\\n        position: absolute;  /* Changed from fixed */\\n        left: \".concat(x + window.scrollX, \"px;  /* Add scrollX */\\n        top: \").concat(y + window.scrollY, \"px;   /* Add scrollY */\\n        background: white;\\n        border-radius: 8px;\\n        box-shadow: 0 2px 10px rgba(0,0,0,0.1);\\n        padding: 8px;\\n        z-index: 10000;\\n    \");\n    // Add scroll event listener to update popup position\n    var updatePosition = function () {\n        var newRect = button.getBoundingClientRect();\n        popup.style.left = \"\".concat(newRect.right + 10, \"px\");\n        popup.style.top = \"\".concat(newRect.top, \"px\");\n    };\n    // Listen for scroll events on the main Gmail container\n    var gmailContainer = document.querySelector('.bkK');\n    if (gmailContainer) {\n        gmailContainer.addEventListener('scroll', updatePosition, true);\n    }\n    // Add click event listener to document\n    var closePopup = function (e) {\n        if (!popup.contains(e.target)) {\n            popup.remove();\n            document.removeEventListener('click', closePopup);\n            if (gmailContainer) {\n                gmailContainer.removeEventListener('scroll', updatePosition, true);\n            }\n        }\n    };\n    // Delay adding the click listener to prevent immediate closure\n    setTimeout(function () {\n        document.addEventListener('click', closePopup);\n    }, 0);\n    chrome.storage.sync.get(['pipelineStages'], function (result) {\n        console.log('Retrieved stages:', result.pipelineStages);\n        var stages = result.pipelineStages || defaultStages;\n        stages.forEach(function (stage) {\n            var option = document.createElement('div');\n            option.style.cssText = \"\\n                padding: 8px 16px;\\n                cursor: pointer;\\n                border-left: 3px solid \".concat(stage.color, \";\\n                margin: 4px 0;\\n            \");\n            option.textContent = stage.name;\n            option.addEventListener('click', function () { return __awaiter(_this, void 0, void 0, function () {\n                var stageElement;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            stageElement = document.querySelector(\"[data-stage-id=\\\"\".concat(stage.id, \"\\\"]\"));\n                            if (!stageElement) return [3 /*break*/, 2];\n                            return [4 /*yield*/, StorageUtils.saveEmailToStage(emailData, stage.id)];\n                        case 1:\n                            _a.sent();\n                            addEmailToStage(emailData, stage, stageElement);\n                            _a.label = 2;\n                        case 2:\n                            popup.remove();\n                            document.removeEventListener('click', closePopup);\n                            if (gmailContainer) {\n                                gmailContainer.removeEventListener('scroll', updatePosition, true);\n                            }\n                            return [2 /*return*/];\n                    }\n                });\n            }); });\n            popup.appendChild(option);\n        });\n    });\n    document.body.appendChild(popup);\n}\n// Add this function to load saved emails when creating stages\n// Update loadSavedEmails function\n// Update the loadSavedEmails function to use StorageUtils\nfunction loadSavedEmails() {\n    return __awaiter(this, void 0, void 0, function () {\n        var stages, currentStages, _loop_1, _i, currentStages_1, stage, error_4;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    _a.trys.push([0, 6, , 7]);\n                    return [4 /*yield*/, chrome.storage.sync.get(['pipelineStages'])];\n                case 1:\n                    stages = _a.sent();\n                    currentStages = stages.pipelineStages || defaultStages;\n                    _loop_1 = function (stage) {\n                        var emails, stageElement, countElement, headerCount, emailsContainer;\n                        return __generator(this, function (_b) {\n                            switch (_b.label) {\n                                case 0:\n                                    console.log(\"stage Called from loadSavedEmails\", stage);\n                                    return [4 /*yield*/, StorageUtils.loadStageEmails(stage.id)];\n                                case 1:\n                                    emails = _b.sent();\n                                    console.log(\"Emails inside LoadSavedEmails:\", emails);\n                                    stageElement = document.querySelector(\"[data-stage-id=\\\"\".concat(stage.id, \"\\\"]\"));\n                                    console.log(\"Stage Element Called from the Load Saved emails\", stageElement);\n                                    if (stageElement) {\n                                        countElement = stageElement.querySelector('.stage-count');\n                                        console.log(\"Count Element Called from Stage Element\", countElement);\n                                        if (countElement) {\n                                            console.log(\"Count Element Cleared\");\n                                            countElement.textContent = '0';\n                                            headerCount = document.querySelector(\".header-count-\".concat(stage.id));\n                                            if (headerCount) {\n                                                headerCount.textContent = '0';\n                                                console.log(\"Cleared header count for stage\", stage.id);\n                                            }\n                                        }\n                                        emailsContainer = stageElement.querySelector('.stage-emails-container');\n                                        console.log(\"Email Container Called within Stage Element Debug: \", emailsContainer);\n                                        if (emailsContainer) {\n                                            console.log(\"Email Container Cleared\");\n                                            emailsContainer.innerHTML = '';\n                                        }\n                                        // Now add the emails from storage\n                                        emails.forEach(function (email) {\n                                            addEmailToStage(email, stage, stageElement);\n                                        });\n                                    }\n                                    return [2 /*return*/];\n                            }\n                        });\n                    };\n                    _i = 0, currentStages_1 = currentStages;\n                    _a.label = 2;\n                case 2:\n                    if (!(_i < currentStages_1.length)) return [3 /*break*/, 5];\n                    stage = currentStages_1[_i];\n                    return [5 /*yield**/, _loop_1(stage)];\n                case 3:\n                    _a.sent();\n                    _a.label = 4;\n                case 4:\n                    _i++;\n                    return [3 /*break*/, 2];\n                case 5: return [3 /*break*/, 7];\n                case 6:\n                    error_4 = _a.sent();\n                    console.error('Error loading saved emails:', error_4);\n                    return [3 /*break*/, 7];\n                case 7: return [2 /*return*/];\n            }\n        });\n    });\n}\nfunction cleanupStorage() {\n    return __awaiter(this, void 0, void 0, function () {\n        var error_5;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    _a.trys.push([0, 4, , 5]);\n                    // Clear both sync and local storage\n                    return [4 /*yield*/, chrome.storage.sync.clear()];\n                case 1:\n                    // Clear both sync and local storage\n                    _a.sent();\n                    return [4 /*yield*/, chrome.storage.local.clear()];\n                case 2:\n                    _a.sent();\n                    console.log('Storage cleaned successfully');\n                    // Reset to default stages\n                    return [4 /*yield*/, chrome.storage.sync.set({ pipelineStages: defaultStages })];\n                case 3:\n                    // Reset to default stages\n                    _a.sent();\n                    console.log('Default stages restored');\n                    return [3 /*break*/, 5];\n                case 4:\n                    error_5 = _a.sent();\n                    console.error('Error cleaning storage:', error_5);\n                    return [3 /*break*/, 5];\n                case 5: return [2 /*return*/];\n            }\n        });\n    });\n}\nfunction observeGmailInbox() {\n    // Prevent multiple initialization\n    if (observerState.isInitialized) {\n        console.log('Observer already initialized, skipping...');\n        return;\n    }\n    console.log('Starting Gmail observer...');\n    function initializeEmailRows() {\n        // Only initialize rows that don't have buttons\n        var emailRows = document.querySelectorAll('tr.zA:not([data-crm-initialized])');\n        if (emailRows.length > 0) {\n            console.log(\"Found \".concat(emailRows.length, \" new email rows to initialize\"));\n            emailRows.forEach(function (row) {\n                if (!row.querySelector('.crm-move-button')) {\n                    makeEmailDraggable(row);\n                    row.setAttribute('data-crm-initialized', 'true');\n                }\n            });\n        }\n    }\n    var findEmailContainer = function () {\n        var targetNode = document.querySelector('.AO, .ain');\n        if (!targetNode) {\n            console.log('Gmail container not found, retrying...');\n            setTimeout(findEmailContainer, 1000);\n            return;\n        }\n        // Only create sidebar once\n        if (!observerState.sidebarCreated) {\n            console.log('Found Gmail container, creating sidebar and observer');\n            createSidebar();\n            observerState.sidebarCreated = true;\n        }\n        var observer = new MutationObserver(function (mutations) {\n            var shouldInitialize = false;\n            mutations.forEach(function (mutation) {\n                if (mutation.addedNodes.length > 0 ||\n                    mutation.type === 'childList') {\n                    shouldInitialize = true;\n                }\n            });\n            if (shouldInitialize) {\n                requestAnimationFrame(function () {\n                    initializeEmailRows();\n                });\n            }\n        });\n        observer.observe(targetNode, {\n            childList: true,\n            subtree: true\n        });\n        // Initial setup\n        requestAnimationFrame(function () {\n            initializeEmailRows();\n        });\n        observerState.isInitialized = true;\n    };\n    findEmailContainer();\n}\nvar addGlobalStyles = function () {\n    var style = document.createElement('style');\n    style.textContent = \"\\n        /* Adjust the main content width to accommodate new column */\\n        .aeF {\\n            width: calc(100% - 40px) !important;\\n        }\\n        \\n        /* Ensure proper alignment of all cells */\\n        .zA > td {\\n            padding: 0 8px;\\n        }\\n        \\n        /* Style for our new column */\\n        .crm-move-button {\\n            opacity: 0;\\n            transition: opacity 0.2s;\\n        }\\n        \\n        .zA:hover .crm-move-button {\\n            opacity: 1;\\n        }\\n    \";\n    document.head.appendChild(style);\n};\n// Add this to your initialization\nwindow.addEventListener('load', function () {\n    console.log('Page loaded, initializing CRM...');\n    addGlobalStyles();\n    // Clean storage before initialization\n    // cleanupStorage().then(() => {\n    //     setTimeout(observeGmailInbox, 1000);\n    // });\n    // Added periodic check to maintain buttons\n    // const maintainButtons = () => {\n    //     const uninitializedRows = document.querySelectorAll('tr.zA:not([data-crm-initialized])');\n    //     if (uninitializedRows.length > 0) {\n    //         uninitializedRows.forEach(row => {\n    //             makeEmailDraggable(row as HTMLElement);\n    //             row.setAttribute('data-crm-initialized', 'true');\n    //         });\n    //     }\n    // };\n    // // Initial setup with delay\n    // setTimeout(observeGmailInbox, 1000);\n    // // Maintain buttons periodically\n    // setInterval(maintainButtons, 2000);\n    // Initial setup with multiple retry attempts for first load\n    var initialSetup = function () {\n        setTimeout(function () {\n            observeGmailInbox();\n            // Specific first-load check for the first 10 rows\n            var checkFirstRows = function () {\n                var firstRows = Array.from(document.querySelectorAll('tr.zA')).slice(0, 50);\n                firstRows.forEach(function (row) {\n                    if (!row.querySelector('.crm-move-button')) {\n                        makeEmailDraggable(row);\n                        row.setAttribute('data-crm-initialized', 'true');\n                    }\n                });\n            };\n            // Multiple checks for the first 10 rows during initial load\n            [100, 500, 1000, 2000].forEach(function (delay) {\n                setTimeout(checkFirstRows, delay);\n            });\n            // Regular backup check continues\n            setInterval(function () {\n                if (!document.querySelector('.crm-move-button')) {\n                    console.log('Buttons missing, reinitializing...');\n                    var rows = document.querySelectorAll('tr.zA:not([data-crm-initialized])');\n                    rows.forEach(function (row) {\n                        makeEmailDraggable(row);\n                        row.setAttribute('data-crm-initialized', 'true');\n                    });\n                }\n            }, 5000);\n        }, 1000);\n    };\n    initialSetup();\n});\nvar init = function () {\n    if (!window.location.origin.includes(GMAIL_URL_PATTERN)) {\n        return;\n    }\n    console.log('Gmail detected, starting observer');\n    observeGmailInbox();\n};\n// Start when page loads\nwindow.addEventListener('load', init);\n","","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = {};\n__webpack_modules__[\"./src/content.tsx\"]();\n",""],"names":[],"sourceRoot":""}